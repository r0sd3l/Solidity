{"ast":null,"code":"const debug = require(\"debug\")(\"contract:utils\");\n\nconst web3Utils = require(\"web3-utils\");\n\nconst {\n  bigNumberify\n} = require(\"ethers/utils/bignumber\");\n\nconst abi = require(\"web3-eth-abi\");\n\nconst BlockchainUtils = require(\"@truffle/blockchain-utils\");\n\nconst reformat = require(\"../reformat\");\n\nconst ens = require(\"./ens\");\n\nconst allowedTxParams = new Set([\"from\", \"to\", \"gas\", \"gasPrice\", \"maxFeePerGas\", \"maxPriorityFeePerGas\", \"value\", \"data\", \"nonce\", \"accessList\", \"type\", \"privateFor\", \"overwrite\"]);\nconst Utils = {\n  is_object(val) {\n    return typeof val === \"object\" && !Array.isArray(val);\n  },\n\n  is_big_number(val) {\n    if (typeof val !== \"object\") return false; //NOTE: For some reason, contrary to the docs,\n    //web3Utils.isBigNumber returns true not only for\n    //bignumber.js BigNumbers, but also for ethers BigNumbers,\n    //even though these are totally different things.\n\n    return web3Utils.isBN(val) || web3Utils.isBigNumber(val);\n  },\n\n  isTxParams(val) {\n    if (!Utils.is_object(val)) return false;\n    if (Utils.is_big_number(val)) return false;\n    return Object.keys(val).some(fieldName => allowedTxParams.has(fieldName));\n  },\n\n  decodeLogs(_logs, isSingle) {\n    const constructor = this;\n    const logs = Utils.toTruffleLog(_logs, isSingle);\n    return logs.map(log => {\n      const logABI = constructor.events[log.topics[0]];\n      if (logABI == null) return null;\n      const copy = Utils.merge({}, log);\n      copy.event = logABI.name;\n      copy.topics = logABI.anonymous ? copy.topics : copy.topics.slice(1);\n      if (copy.data === \"0x\") copy.data = \"\";\n      let logArgs;\n\n      try {\n        logArgs = abi.decodeLog(logABI.inputs, copy.data, copy.topics);\n        copy.args = reformat.numbers.call(constructor, logArgs, logABI.inputs);\n      } catch (_) {\n        return null;\n      }\n\n      delete copy.data;\n      delete copy.topics;\n      return copy;\n    }).filter(log => log != null);\n  },\n\n  toTruffleLog(events, isSingle) {\n    // Transform singletons (from event listeners) to the kind of\n    // object we find on the receipt\n    if (isSingle && typeof isSingle === \"boolean\") {\n      const temp = [];\n      temp.push(events);\n      return temp.map(log => {\n        log.data = log.raw.data;\n        log.topics = log.raw.topics;\n        return log;\n      });\n    } // Or reformat items in the existing array\n\n\n    events.forEach(event => {\n      if (event.raw) {\n        event.data = event.raw.data;\n        event.topics = event.raw.topics;\n      }\n    });\n    return events;\n  },\n\n  merge() {\n    const merged = {};\n    const args = Array.prototype.slice.call(arguments);\n\n    for (let i = 0; i < args.length; i++) {\n      const object = args[i];\n      const keys = Object.keys(object);\n\n      for (let j = 0; j < keys.length; j++) {\n        const key = keys[j];\n        const value = object[key];\n        merged[key] = value;\n      }\n    }\n\n    return merged;\n  },\n\n  linkBytecode(bytecode, links) {\n    Object.keys(links).forEach(library_name => {\n      const library_address = links[library_name];\n      const regex = new RegExp(`__${library_name}_+`, \"g\");\n      bytecode = bytecode.replace(regex, library_address.replace(\"0x\", \"\"));\n    });\n    return bytecode;\n  },\n\n  // Extracts optional tx params from a list of fn arguments\n  getTxParams(methodABI, args) {\n    let ignoreDefaultGasPriceParams = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    const constructor = this;\n    const expectedArgCount = methodABI ? methodABI.inputs.length : 0;\n    let txParams = {};\n    const lastArg = args[args.length - 1];\n\n    if (args.length === expectedArgCount + 1 && Utils.isTxParams(lastArg)) {\n      txParams = args.pop();\n    }\n\n    let defaultParams = constructor.class_defaults;\n\n    if (ignoreDefaultGasPriceParams) {\n      //this parameter is set when making calls (as opposed to transactions)\n      //gas price params can cause problems with those on some networks, so\n      //we ignore any defaults, and only include them if they were explicitly\n      //specified\n      defaultParams = { ...constructor.class_defaults\n      }; //clone\n\n      delete defaultParams.gasPrice;\n      delete defaultParams.maxFeePerGas;\n      delete defaultParams.maxPriorityFeePerGas;\n    }\n\n    return Utils.merge(defaultParams, txParams);\n  },\n\n  // Verifies that a contracts libraries have been linked correctly.\n  // Throws on error\n  checkLibraries() {\n    const constructor = this;\n    const regex = /__[^_]+_+/g;\n    let unlinkedLibraries = constructor.binary.match(regex);\n\n    if (unlinkedLibraries !== null) {\n      unlinkedLibraries = unlinkedLibraries.map((name // Remove underscores\n      ) => name.replace(/_/g, \"\")).sort().filter((name, index, arr) => {\n        // Remove duplicates\n        if (index + 1 >= arr.length) {\n          return true;\n        }\n\n        return name !== arr[index + 1];\n      }).join(\", \");\n      const error = `${constructor.contractName} contains unresolved libraries. You must deploy and link the following libraries before you can deploy a new version of ${constructor.contractName}: ${unlinkedLibraries}`;\n      throw new Error(error);\n    }\n  },\n\n  convertToEthersBN(original) {\n    const converted = [];\n    original.forEach(item => {\n      // Recurse for arrays\n      if (Array.isArray(item)) {\n        converted.push(Utils.convertToEthersBN(item)); // Convert Web3 BN / BigNumber\n      } else if (Utils.is_big_number(item)) {\n        //HACK: Since we can't rely on web3Utils.isBigNumber to tell\n        //whether we have a bignumber.js BigNumber, we'll just check\n        //whether it has the toFixed method\n        const stringValue = item.toFixed ? item.toFixed() //prevents use of scientific notation\n        : item.toString();\n        const ethersBN = bigNumberify(stringValue);\n        converted.push(ethersBN);\n      } else {\n        converted.push(item);\n      }\n    });\n    return converted;\n  },\n\n  /**\n   * Multiplies an ethers.js BigNumber and a number with decimal places using\n   * integer math rather than using an arbitrary floating-point library like\n   * `bignumber.js`.\n   * @param  {BigNumber} bignum            an ethers.js BigNumber (use bigNumberify)\n   * @param  {Number}    decimal           a number which has 0+ decimal places\n   * @param  {Number}    [maxPrecision=5]  the max number of signficant figures\n   *                                       `decimal` can have. (default: 5)\n   * @return {BigNumber}                   floor(bignum * decimal)\n   */\n  multiplyBigNumberByDecimal(bignum, decimal, maxPrecision) {\n    if (typeof maxPrecision === \"undefined\") {\n      maxPrecision = 5;\n    }\n\n    const significantFigures = Math.min(decimal.toString().length - 1, // length less one because `.`\n    maxPrecision);\n    const denominator = bigNumberify(10).pow(significantFigures);\n    const multiplier = Math.round(decimal * denominator);\n    const numerator = bigNumberify(multiplier).mul(bignum);\n    return numerator.div(denominator);\n  },\n\n  // checks if given contract instance has a set provider\n  checkProvider(_ref) {\n    let {\n      currentProvider,\n      contractName\n    } = _ref;\n    if (!currentProvider) throw new Error(`${contractName} error: Please call setProvider() first before calling new().`);\n  },\n\n  // verifies current network has been assigned to contract instance\n  checkNetworkArtifactMatch(_ref2) {\n    let {\n      networks,\n      network_id,\n      contractName\n    } = _ref2;\n    if (networks[network_id] == null) throw new Error(`${contractName} has not been deployed to detected network (network/artifact mismatch)`);\n  },\n\n  // verifies contract instance has been deployed\n  checkDeployment(_ref3) {\n    let {\n      isDeployed,\n      contractName,\n      network_id\n    } = _ref3;\n    if (!isDeployed()) throw new Error(`${contractName} has not been deployed to detected network (${network_id})`);\n  },\n\n  // checks if provided contract address has on-chain code\n  checkCode(onChainCode, contractName, address) {\n    if (!onChainCode || onChainCode.replace(\"0x\", \"\").replace(/0/g, \"\") === \"\") throw new Error(`Cannot create instance of ${contractName}; no code at address ${address}`);\n  },\n\n  // parses known contract instance networks\n  async parseKnownNetworks(_ref4, gasLimit) {\n    let {\n      networks,\n      currentProvider,\n      setNetwork,\n      network_id\n    } = _ref4;\n\n    if (!networks && Object.keys(networks).length === 0) {\n      return false;\n    } // go through all the networks that are listed as\n    // blockchain uris and see if they match\n\n\n    for (const network in networks) {\n      if (network.startsWith(\"blockchain://\")) {\n        const networkMatches = await BlockchainUtils.matches(network, currentProvider);\n\n        if (networkMatches) {\n          setNetwork(network);\n          return {\n            id: network_id,\n            blockLimit: gasLimit\n          };\n        }\n      }\n    } // no match found!\n\n\n    return false;\n  },\n\n  // sets a contract instance network ID\n  async setInstanceNetworkID(TruffleContractInstance, chainNetworkID, gasLimit) {\n    // if chainNetworkID already present as network configuration, use it\n    if (TruffleContractInstance.hasNetwork(chainNetworkID)) {\n      TruffleContractInstance.setNetwork(chainNetworkID);\n      return {\n        id: TruffleContractInstance.network_id,\n        blockLimit: gasLimit\n      };\n    } // chainNetworkID not present,\n    // parse all known networks\n\n\n    const matchedNetwork = await Utils.parseKnownNetworks(TruffleContractInstance, gasLimit);\n    if (matchedNetwork) return matchedNetwork; // network unknown, trust the provider and use given chainNetworkID\n\n    TruffleContractInstance.setNetwork(chainNetworkID);\n    return {\n      id: TruffleContractInstance.network_id,\n      blockLimit: gasLimit\n    };\n  }\n\n};\nUtils.ens = ens;\nUtils.bigNumberify = bigNumberify;\nmodule.exports = Utils;","map":{"version":3,"sources":["C:/Users/rodri/Solidity/solidity/faucet/node_modules/@truffle/contract/lib/utils/index.js"],"names":["debug","require","web3Utils","bigNumberify","abi","BlockchainUtils","reformat","ens","allowedTxParams","Set","Utils","is_object","val","Array","isArray","is_big_number","isBN","isBigNumber","isTxParams","Object","keys","some","fieldName","has","decodeLogs","_logs","isSingle","constructor","logs","toTruffleLog","map","log","logABI","events","topics","copy","merge","event","name","anonymous","slice","data","logArgs","decodeLog","inputs","args","numbers","call","_","filter","temp","push","raw","forEach","merged","prototype","arguments","i","length","object","j","key","value","linkBytecode","bytecode","links","library_name","library_address","regex","RegExp","replace","getTxParams","methodABI","ignoreDefaultGasPriceParams","expectedArgCount","txParams","lastArg","pop","defaultParams","class_defaults","gasPrice","maxFeePerGas","maxPriorityFeePerGas","checkLibraries","unlinkedLibraries","binary","match","sort","index","arr","join","error","contractName","Error","convertToEthersBN","original","converted","item","stringValue","toFixed","toString","ethersBN","multiplyBigNumberByDecimal","bignum","decimal","maxPrecision","significantFigures","Math","min","denominator","pow","multiplier","round","numerator","mul","div","checkProvider","currentProvider","checkNetworkArtifactMatch","networks","network_id","checkDeployment","isDeployed","checkCode","onChainCode","address","parseKnownNetworks","gasLimit","setNetwork","network","startsWith","networkMatches","matches","id","blockLimit","setInstanceNetworkID","TruffleContractInstance","chainNetworkID","hasNetwork","matchedNetwork","module","exports"],"mappings":"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","sourcesContent":["const debug = require(\"debug\")(\"contract:utils\");\nconst web3Utils = require(\"web3-utils\");\nconst { bigNumberify } = require(\"ethers/utils/bignumber\");\nconst abi = require(\"web3-eth-abi\");\nconst BlockchainUtils = require(\"@truffle/blockchain-utils\");\nconst reformat = require(\"../reformat\");\nconst ens = require(\"./ens\");\n\nconst allowedTxParams = new Set([\n  \"from\",\n  \"to\",\n  \"gas\",\n  \"gasPrice\",\n  \"maxFeePerGas\",\n  \"maxPriorityFeePerGas\",\n  \"value\",\n  \"data\",\n  \"nonce\",\n  \"accessList\",\n  \"type\",\n  \"privateFor\",\n  \"overwrite\"\n]);\n\nconst Utils = {\n  is_object(val) {\n    return typeof val === \"object\" && !Array.isArray(val);\n  },\n\n  is_big_number(val) {\n    if (typeof val !== \"object\") return false;\n\n    //NOTE: For some reason, contrary to the docs,\n    //web3Utils.isBigNumber returns true not only for\n    //bignumber.js BigNumbers, but also for ethers BigNumbers,\n    //even though these are totally different things.\n    return web3Utils.isBN(val) || web3Utils.isBigNumber(val);\n  },\n\n  isTxParams(val) {\n    if (!Utils.is_object(val)) return false;\n    if (Utils.is_big_number(val)) return false;\n    return Object.keys(val).some(fieldName => allowedTxParams.has(fieldName));\n  },\n\n  decodeLogs(_logs, isSingle) {\n    const constructor = this;\n    const logs = Utils.toTruffleLog(_logs, isSingle);\n\n    return logs\n      .map(log => {\n        const logABI = constructor.events[log.topics[0]];\n\n        if (logABI == null) return null;\n\n        const copy = Utils.merge({}, log);\n\n        copy.event = logABI.name;\n        copy.topics = logABI.anonymous ? copy.topics : copy.topics.slice(1);\n\n        if (copy.data === \"0x\") copy.data = \"\";\n\n        let logArgs;\n        try {\n          logArgs = abi.decodeLog(logABI.inputs, copy.data, copy.topics);\n          copy.args = reformat.numbers.call(\n            constructor,\n            logArgs,\n            logABI.inputs\n          );\n        } catch (_) {\n          return null;\n        }\n\n        delete copy.data;\n        delete copy.topics;\n\n        return copy;\n      })\n      .filter(log => log != null);\n  },\n\n  toTruffleLog(events, isSingle) {\n    // Transform singletons (from event listeners) to the kind of\n    // object we find on the receipt\n    if (isSingle && typeof isSingle === \"boolean\") {\n      const temp = [];\n      temp.push(events);\n      return temp.map(log => {\n        log.data = log.raw.data;\n        log.topics = log.raw.topics;\n        return log;\n      });\n    }\n\n    // Or reformat items in the existing array\n    events.forEach(event => {\n      if (event.raw) {\n        event.data = event.raw.data;\n        event.topics = event.raw.topics;\n      }\n    });\n\n    return events;\n  },\n\n  merge() {\n    const merged = {};\n    const args = Array.prototype.slice.call(arguments);\n\n    for (let i = 0; i < args.length; i++) {\n      const object = args[i];\n      const keys = Object.keys(object);\n      for (let j = 0; j < keys.length; j++) {\n        const key = keys[j];\n        const value = object[key];\n        merged[key] = value;\n      }\n    }\n\n    return merged;\n  },\n\n  linkBytecode(bytecode, links) {\n    Object.keys(links).forEach(library_name => {\n      const library_address = links[library_name];\n      const regex = new RegExp(`__${library_name}_+`, \"g\");\n\n      bytecode = bytecode.replace(regex, library_address.replace(\"0x\", \"\"));\n    });\n\n    return bytecode;\n  },\n\n  // Extracts optional tx params from a list of fn arguments\n  getTxParams(methodABI, args, ignoreDefaultGasPriceParams = false) {\n    const constructor = this;\n\n    const expectedArgCount = methodABI ? methodABI.inputs.length : 0;\n\n    let txParams = {};\n    const lastArg = args[args.length - 1];\n\n    if (args.length === expectedArgCount + 1 && Utils.isTxParams(lastArg)) {\n      txParams = args.pop();\n    }\n\n    let defaultParams = constructor.class_defaults;\n    if (ignoreDefaultGasPriceParams) {\n      //this parameter is set when making calls (as opposed to transactions)\n      //gas price params can cause problems with those on some networks, so\n      //we ignore any defaults, and only include them if they were explicitly\n      //specified\n      defaultParams = { ...constructor.class_defaults }; //clone\n      delete defaultParams.gasPrice;\n      delete defaultParams.maxFeePerGas;\n      delete defaultParams.maxPriorityFeePerGas;\n    }\n\n    return Utils.merge(defaultParams, txParams);\n  },\n\n  // Verifies that a contracts libraries have been linked correctly.\n  // Throws on error\n  checkLibraries() {\n    const constructor = this;\n    const regex = /__[^_]+_+/g;\n    let unlinkedLibraries = constructor.binary.match(regex);\n\n    if (unlinkedLibraries !== null) {\n      unlinkedLibraries = unlinkedLibraries\n        .map(\n          (\n            name // Remove underscores\n          ) => name.replace(/_/g, \"\")\n        )\n        .sort()\n        .filter((name, index, arr) => {\n          // Remove duplicates\n          if (index + 1 >= arr.length) {\n            return true;\n          }\n\n          return name !== arr[index + 1];\n        })\n        .join(\", \");\n\n      const error = `${constructor.contractName} contains unresolved libraries. You must deploy and link the following libraries before you can deploy a new version of ${constructor.contractName}: ${unlinkedLibraries}`;\n\n      throw new Error(error);\n    }\n  },\n\n  convertToEthersBN(original) {\n    const converted = [];\n    original.forEach(item => {\n      // Recurse for arrays\n      if (Array.isArray(item)) {\n        converted.push(Utils.convertToEthersBN(item));\n\n        // Convert Web3 BN / BigNumber\n      } else if (Utils.is_big_number(item)) {\n        //HACK: Since we can't rely on web3Utils.isBigNumber to tell\n        //whether we have a bignumber.js BigNumber, we'll just check\n        //whether it has the toFixed method\n        const stringValue = item.toFixed\n          ? item.toFixed() //prevents use of scientific notation\n          : item.toString();\n        const ethersBN = bigNumberify(stringValue);\n        converted.push(ethersBN);\n      } else {\n        converted.push(item);\n      }\n    });\n    return converted;\n  },\n\n  /**\n   * Multiplies an ethers.js BigNumber and a number with decimal places using\n   * integer math rather than using an arbitrary floating-point library like\n   * `bignumber.js`.\n   * @param  {BigNumber} bignum            an ethers.js BigNumber (use bigNumberify)\n   * @param  {Number}    decimal           a number which has 0+ decimal places\n   * @param  {Number}    [maxPrecision=5]  the max number of signficant figures\n   *                                       `decimal` can have. (default: 5)\n   * @return {BigNumber}                   floor(bignum * decimal)\n   */\n  multiplyBigNumberByDecimal(bignum, decimal, maxPrecision) {\n    if (typeof maxPrecision === \"undefined\") {\n      maxPrecision = 5;\n    }\n\n    const significantFigures = Math.min(\n      decimal.toString().length - 1, // length less one because `.`\n      maxPrecision\n    );\n\n    const denominator = bigNumberify(10).pow(significantFigures);\n    const multiplier = Math.round(decimal * denominator);\n    const numerator = bigNumberify(multiplier).mul(bignum);\n\n    return numerator.div(denominator);\n  },\n\n  // checks if given contract instance has a set provider\n  checkProvider({ currentProvider, contractName }) {\n    if (!currentProvider)\n      throw new Error(\n        `${contractName} error: Please call setProvider() first before calling new().`\n      );\n  },\n\n  // verifies current network has been assigned to contract instance\n  checkNetworkArtifactMatch({ networks, network_id, contractName }) {\n    if (networks[network_id] == null)\n      throw new Error(\n        `${contractName} has not been deployed to detected network (network/artifact mismatch)`\n      );\n  },\n\n  // verifies contract instance has been deployed\n  checkDeployment({ isDeployed, contractName, network_id }) {\n    if (!isDeployed())\n      throw new Error(\n        `${contractName} has not been deployed to detected network (${network_id})`\n      );\n  },\n\n  // checks if provided contract address has on-chain code\n  checkCode(onChainCode, contractName, address) {\n    if (!onChainCode || onChainCode.replace(\"0x\", \"\").replace(/0/g, \"\") === \"\")\n      throw new Error(\n        `Cannot create instance of ${contractName}; no code at address ${address}`\n      );\n  },\n\n  // parses known contract instance networks\n  async parseKnownNetworks(\n    { networks, currentProvider, setNetwork, network_id },\n    gasLimit\n  ) {\n    if (!networks && Object.keys(networks).length === 0) {\n      return false;\n    }\n    // go through all the networks that are listed as\n    // blockchain uris and see if they match\n    for (const network in networks) {\n      if (network.startsWith(\"blockchain://\")) {\n        const networkMatches = await BlockchainUtils.matches(\n          network,\n          currentProvider\n        );\n        if (networkMatches) {\n          setNetwork(network);\n          return {\n            id: network_id,\n            blockLimit: gasLimit\n          };\n        }\n      }\n    }\n    // no match found!\n    return false;\n  },\n\n  // sets a contract instance network ID\n  async setInstanceNetworkID(\n    TruffleContractInstance,\n    chainNetworkID,\n    gasLimit\n  ) {\n    // if chainNetworkID already present as network configuration, use it\n    if (TruffleContractInstance.hasNetwork(chainNetworkID)) {\n      TruffleContractInstance.setNetwork(chainNetworkID);\n      return {\n        id: TruffleContractInstance.network_id,\n        blockLimit: gasLimit\n      };\n    }\n    // chainNetworkID not present,\n    // parse all known networks\n    const matchedNetwork = await Utils.parseKnownNetworks(\n      TruffleContractInstance,\n      gasLimit\n    );\n    if (matchedNetwork) return matchedNetwork;\n\n    // network unknown, trust the provider and use given chainNetworkID\n    TruffleContractInstance.setNetwork(chainNetworkID);\n    return { id: TruffleContractInstance.network_id, blockLimit: gasLimit };\n  }\n};\n\nUtils.ens = ens;\nUtils.bigNumberify = bigNumberify;\n\nmodule.exports = Utils;\n"]},"metadata":{},"sourceType":"script"}