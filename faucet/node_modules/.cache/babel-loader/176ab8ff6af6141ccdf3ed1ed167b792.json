{"ast":null,"code":"const {\n  default: ENSJS,\n  getEnsAddress\n} = require(\"@ensdomains/ensjs\");\n\nconst {\n  isAddress\n} = require(\"web3-utils\");\n\nmodule.exports = {\n  convertENSNames: async function (_ref) {\n    let {\n      ens,\n      inputArgs,\n      methodABI,\n      inputParams,\n      web3,\n      networkId\n    } = _ref;\n    const {\n      registryAddress\n    } = ens;\n    let args;\n\n    if (inputArgs.length && methodABI) {\n      args = await this.convertENSArgsNames({\n        inputArgs,\n        methodABI,\n        web3,\n        registryAddress,\n        networkId\n      });\n    } else {\n      args = inputArgs;\n    }\n\n    let params;\n\n    if (inputParams) {\n      params = await this.convertENSParamsNames({\n        inputParams,\n        web3,\n        registryAddress,\n        networkId\n      });\n    }\n\n    return {\n      args,\n      params\n    };\n  },\n  getNewENSJS: function (_ref2) {\n    let {\n      provider,\n      registryAddress,\n      networkId\n    } = _ref2;\n    return new ENSJS({\n      provider,\n      ensAddress: registryAddress || getEnsAddress(networkId)\n    });\n  },\n  resolveNameToAddress: async function (_ref3) {\n    let {\n      name,\n      provider,\n      registryAddress,\n      networkId\n    } = _ref3;\n    let ensjs;\n\n    try {\n      ensjs = this.getNewENSJS({\n        provider,\n        registryAddress,\n        networkId\n      });\n    } catch (error) {\n      const message = \"There was a problem initializing the ENS library.\" + \"Please ensure you have the address of the registry set correctly.\" + ` Truffle is currently using ${registryAddress}.`;\n      throw new Error(`${message} - ${error.message}`);\n    }\n\n    return await ensjs.name(name).getAddress(\"ETH\");\n  },\n  convertENSArgsNames: function (_ref4) {\n    let {\n      inputArgs,\n      methodABI,\n      web3,\n      registryAddress,\n      networkId\n    } = _ref4;\n    if (methodABI.inputs.length === 0) return inputArgs;\n    const convertedNames = inputArgs.map((argument, index) => {\n      if (index + 1 > methodABI.inputs.length) {\n        return argument;\n      } else if (methodABI.inputs[index].type === \"address\") {\n        // Check all address arguments for ENS names\n        const argIsAddress = isAddress(argument);\n        if (argIsAddress) return argument;\n        return this.resolveNameToAddress({\n          name: argument,\n          provider: web3.currentProvider,\n          registryAddress,\n          networkId\n        });\n      } else {\n        return argument;\n      }\n    });\n    return Promise.all(convertedNames);\n  },\n  convertENSParamsNames: async function (_ref5) {\n    let {\n      inputParams,\n      web3,\n      registryAddress,\n      networkId\n    } = _ref5;\n    let outputParams = inputParams;\n\n    if (inputParams.from && !isAddress(inputParams.from)) {\n      const newFrom = await this.resolveNameToAddress({\n        name: inputParams.from,\n        provider: web3.currentProvider,\n        networkId,\n        registryAddress\n      });\n      outputParams = { ...outputParams,\n        from: newFrom\n      };\n    }\n\n    if (inputParams.accessList && Array.isArray(inputParams.accessList)) {\n      const newAccessList = await Promise.all(inputParams.accessList.map(async entry => {\n        if (entry && entry.address && !isAddress(entry.address)) {\n          const newAddress = await this.resolveNameToAddress({\n            name: entry.address,\n            provider: web3.currentProvider,\n            networkId,\n            registryAddress\n          });\n          return { ...entry,\n            address: newAddress\n          };\n        } else {\n          return entry;\n        }\n      }));\n      outputParams = { ...outputParams,\n        accessList: newAccessList\n      };\n    }\n\n    return outputParams;\n  }\n};","map":{"version":3,"sources":["C:/Users/rodri/Solidity/solidity/faucet/node_modules/@truffle/contract/lib/utils/ens.js"],"names":["default","ENSJS","getEnsAddress","require","isAddress","module","exports","convertENSNames","ens","inputArgs","methodABI","inputParams","web3","networkId","registryAddress","args","length","convertENSArgsNames","params","convertENSParamsNames","getNewENSJS","provider","ensAddress","resolveNameToAddress","name","ensjs","error","message","Error","getAddress","inputs","convertedNames","map","argument","index","type","argIsAddress","currentProvider","Promise","all","outputParams","from","newFrom","accessList","Array","isArray","newAccessList","entry","address","newAddress"],"mappings":"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","sourcesContent":["const { default: ENSJS, getEnsAddress } = require(\"@ensdomains/ensjs\");\nconst { isAddress } = require(\"web3-utils\");\n\nmodule.exports = {\n  convertENSNames: async function ({\n    ens,\n    inputArgs,\n    methodABI,\n    inputParams,\n    web3,\n    networkId\n  }) {\n    const { registryAddress } = ens;\n    let args;\n    if (inputArgs.length && methodABI) {\n      args = await this.convertENSArgsNames({\n        inputArgs,\n        methodABI,\n        web3,\n        registryAddress,\n        networkId\n      });\n    } else {\n      args = inputArgs;\n    }\n    let params;\n    if (inputParams) {\n      params = await this.convertENSParamsNames({\n        inputParams,\n        web3,\n        registryAddress,\n        networkId\n      });\n    }\n    return { args, params };\n  },\n\n  getNewENSJS: function ({ provider, registryAddress, networkId }) {\n    return new ENSJS({\n      provider,\n      ensAddress: registryAddress || getEnsAddress(networkId)\n    });\n  },\n\n  resolveNameToAddress: async function ({\n    name,\n    provider,\n    registryAddress,\n    networkId\n  }) {\n    let ensjs;\n    try {\n      ensjs = this.getNewENSJS({\n        provider,\n        registryAddress,\n        networkId\n      });\n    } catch (error) {\n      const message =\n        \"There was a problem initializing the ENS library.\" +\n        \"Please ensure you have the address of the registry set correctly.\" +\n        ` Truffle is currently using ${registryAddress}.`;\n      throw new Error(`${message} - ${error.message}`);\n    }\n    return await ensjs.name(name).getAddress(\"ETH\");\n  },\n\n  convertENSArgsNames: function ({\n    inputArgs,\n    methodABI,\n    web3,\n    registryAddress,\n    networkId\n  }) {\n    if (methodABI.inputs.length === 0) return inputArgs;\n\n    const convertedNames = inputArgs.map((argument, index) => {\n      if (index + 1 > methodABI.inputs.length) {\n        return argument;\n      } else if (methodABI.inputs[index].type === \"address\") {\n        // Check all address arguments for ENS names\n        const argIsAddress = isAddress(argument);\n        if (argIsAddress) return argument;\n        return this.resolveNameToAddress({\n          name: argument,\n          provider: web3.currentProvider,\n          registryAddress,\n          networkId\n        });\n      } else {\n        return argument;\n      }\n    });\n    return Promise.all(convertedNames);\n  },\n\n  convertENSParamsNames: async function ({\n    inputParams,\n    web3,\n    registryAddress,\n    networkId\n  }) {\n    let outputParams = inputParams;\n    if (inputParams.from && !isAddress(inputParams.from)) {\n      const newFrom = await this.resolveNameToAddress({\n        name: inputParams.from,\n        provider: web3.currentProvider,\n        networkId,\n        registryAddress\n      });\n      outputParams = {\n        ...outputParams,\n        from: newFrom\n      };\n    }\n    if (inputParams.accessList && Array.isArray(inputParams.accessList)) {\n      const newAccessList = await Promise.all(\n        inputParams.accessList.map(async (entry) => {\n          if (entry && entry.address && !isAddress(entry.address)) {\n            const newAddress = await this.resolveNameToAddress({\n              name: entry.address,\n              provider: web3.currentProvider,\n              networkId,\n              registryAddress\n            });\n            return {\n              ...entry,\n              address: newAddress\n            };\n          } else {\n            return entry;\n          }\n        })\n      );\n      outputParams = {\n        ...outputParams,\n        accessList: newAccessList\n      };\n    }\n    return outputParams;\n  }\n};\n"]},"metadata":{},"sourceType":"script"}